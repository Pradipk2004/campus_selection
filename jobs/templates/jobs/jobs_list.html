{% extends "base.html" %}
{% load static %}
{% load widget_tweaks %}

{% block content %}
<h3 class="mb-4">Available Jobs</h3>

<!-- Display Django messages -->
{% if messages %}
  {% for message in messages %}
    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
      {{ message }}
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  {% endfor %}
{% endif %}

<div class="row">
  {% for job in jobs %}
  <div class="col-md-4 mb-3">
    <div class="card shadow-sm">
      <div class="card-body">
        <h5 class="card-title">{{ job.title }}</h5>
        <p class="card-text text-muted">{{ job.company }}</p>
        <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#applyModal{{ job.id }}">
          Apply
        </button>
      </div>
    </div>
  </div>

  <!-- Apply Modal -->
  <div class="modal fade" id="applyModal{{ job.id }}" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <form method="post" action="{% url 'jobs:list' %}" enctype="multipart/form-data">
          {% csrf_token %}
          <input type="hidden" name="job_id" value="{{ job.id }}">
          <div class="modal-header">
            <h5 class="modal-title">Apply for {{ job.title }}</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="mb-2">
              <label class="form-label">Upload Resume</label>
              <input type="file" class="form-control" name="resume" required>
            </div>
            <div class="mb-2">
              <label class="form-label">Cover Letter</label>
              <textarea class="form-control" name="cover_letter" placeholder="Cover Letter..." rows="4"></textarea>
            </div>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-success">Submit Application</button>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          </div>
        </form>
      </div>
    </div>
  </div>
  {% endfor %}
</div>

<style>
.card { border-radius: 12px; transition: transform 0.3s, box-shadow 0.3s; }
.card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.2); }
</style>
{% endblock %}
